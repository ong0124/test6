const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BUENnH7Y.js","./BqvXlzcD.js","./QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{d as A,H as M,r as d,I as U,j as T,o as Q,t as r,v as c,x as e,z as m,J as q,K as G,L as w,M as S,N as B,y as n,O as h,P as J,Q as F}from"./BqvXlzcD.js";import{_ as K,a as W}from"./Be-tDOH9.js";import Y from"./KfJESrNl.js";import{_ as X}from"./DNuRGF_1.js";import{f as H}from"./DKHbzS_t.js";const Z={class:"flex justify-evenly items-center"},tt={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},et={class:"flex flex-col ml-2 mb-16"},st={class:"table-fixed min-w-full border-collapse border mr-12"},at={class:"bg-gray-100"},ot={key:0,class:"border p-2 text-xs md:text-sm bg-indigo-50"},lt={class:"border p-2 text-xs md:text-md sticky left-0 bg-gray-50 z-10"},nt={class:"border p-2 text-xs md:text-sm"},rt={class:"border p-2 text-xs md:text-sm"},ct={class:"border p-2 text-xs md:text-sm"},dt={class:"border p-2 text-xs md:text-sm"},it={class:"border p-2 text-xs md:text-sm"},ut={class:"border p-2 text-xs md:text-sm"},mt={class:"border p-2 text-xs md:text-sm"},_t={class:"border p-2 text-xs md:text-sm"},pt={class:"border p-2 text-xs md:text-sm"},ft={class:"border p-2 text-xs md:text-sm"},xt={class:"border p-2 text-xs md:text-sm"},ht={key:0},yt=["onClick"],$=10,Ct=A({__name:"index",setup(vt){const{t:_}=M(),y=d(""),E=U(),k=async()=>{const{jsPDF:t}=await F(async()=>{const{jsPDF:o}=await import("./BUENnH7Y.js");return{jsPDF:o}},__vite__mapDeps([0,1,2]),import.meta.url),l=(await F(async()=>{const{default:o}=await import("./CfO62xhj.js");return{default:o}},[],import.meta.url)).default,s=new t,b=await(await fetch("/fonts/SourceHanSans-Normal.ttf")).arrayBuffer(),a=btoa(new Uint8Array(b).reduce((o,z)=>o+String.fromCharCode(z),""));s.addFileToVFS("SourceHanSans-Normal.ttf",a),s.addFont("SourceHanSans-Normal.ttf","SourceHanSans-Normal","normal"),s.setFont("SourceHanSans-Normal"),s.text("訂單詳情",14,10);const u=[D],I=g.value.map(o=>[o.id,o.contact,o.phone,_(`${o.departure_loc}`),_(`${o.destination_loc}`),H(o.shuttle_date),o.shuttle_time,o.status,o.adult_num,o.child_num,o.totalTickets,o.totalprice]);l(s,{head:u,body:I,startY:20,styles:{fontSize:10,font:"SourceHanSans-Normal"},headStyles:{font:"SourceHanSans-Normal",fontStyle:"normal",fillColor:[22,160,133]},alternateRowStyles:{fillColor:[240,240,240]}}),s.save("訂單詳情.pdf")},O=T(()=>{const t=y.value.toLowerCase();return C.value.filter(l=>Object.values(l).some(s=>String(s).toLowerCase().includes(t)))}),D=["訂單 ID","聯絡人","電話號碼","上車地點","下車地點","日期","時間","狀態","成人票(人)","兒童票(人)","全票數","總價格"],L=d(1),g=T(()=>{const t=(L.value-1)*$;return O.value.slice(t,t+$)}),V=t=>({"text-green-600 font-bold":t==="已完成","text-red-600 font-bold":t==="未出行","text-yellow-600 font-bold":t==="处理中"}),C=d([]),N=d([]),i=d("departure_loc"),p=async(t="departure_loc")=>{try{const l=await $fetch("/api/GETbooking",{query:{sortBy:t}});N.value=l.data,C.value=N.value.map(s=>({id:s.id,departure_loc:s.departure_loc,destination_loc:s.destination_loc,shuttle_date:s.shuttle_date,shuttle_time:s.shuttle_time,status:s.status,adult_num:s.adult_num,child_num:s.child_num,totalTickets:s.total_tickets,totalprice:s.totalprice,contact:s.contact_name,phone:s.contact_phone}))}catch(l){console.error("Fetch error:",l),alert("獲取數據失敗")}};Q(()=>p(i.value));const f=d(null),x=d(!1),R=async t=>{console.log("選擇的動作:",t),t==="print"?k():t==="delete"?(x.value=!0,f.value&&f.value.scrollTo({left:f.value.scrollWidth,behavior:"smooth"})):t==="add"?E.push("/addOrders"):t==="timeAsc"?(i.value="shuttle_time",await p(i.value)):t==="locAsc"&&(i.value="departure_loc",await p(i.value))},j=async t=>{console.log("ID"+t);try{await $fetch("/api/DeleteBookingById",{method:"DELETE",body:{id:t}})?await p():alert("Post Failed: No valid response")}catch{alert("Delete error")}};return(t,l)=>{const s=K,v=Y,P=X,b=W;return c(),r(S,null,[e("div",null,[m(s)]),e("div",null,[e("div",Z,[e("div",tt,[m(v,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),q(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[G,y.value]])]),m(P,{onItemSelected:R,class:"z-20"})]),e("div",et,[e("div",{ref_key:"scrollContainer",ref:f,class:"overflow-x-auto w-full pb-4"},[e("table",st,[e("thead",null,[e("tr",at,[l[1]||(l[1]=e("th",{class:"border p-2 text-xs md:text-sm sticky left-0 bg-indigo-50"},"訂單ID",-1)),(c(!0),r(S,null,B(D.slice(1),(a,u)=>(c(),r("th",{key:u,class:"border p-2 text-xs md:text-sm bg-indigo-50"},n(a),1))),128)),x.value?(c(),r("th",ot," 操作 ")):w("",!0)])]),e("tbody",null,[(c(!0),r(S,null,B(h(g),(a,u)=>(c(),r("tr",{key:u,class:"border-b text-center"},[e("td",lt,n(a.id),1),e("td",nt,n(a.contact),1),e("td",rt,n(a.phone),1),e("td",ct,n(h(_)(`${a.departure_loc}`)),1),e("td",dt,n(h(_)(`${a.destination_loc}`)),1),e("td",it,n(("formatDate"in t?t.formatDate:h(H))(a.shuttle_date)),1),e("td",ut,n(a.shuttle_time),1),e("td",mt,[e("span",{class:J(V(a.status))},n(a.status),3)]),e("td",_t,n(a.adult_num),1),e("td",pt,n(a.child_num),1),e("td",ft,n(a.totalTickets),1),e("td",xt,n(a.totalprice),1),x.value?(c(),r("th",ht,[x.value?(c(),r("button",{key:0,class:"text-red-500 px-4 py-1 rounded",onClick:I=>j(a.id)},[m(v,{name:"mdi:delete",class:"text-red-500 w-5 h-5"})],8,yt)):w("",!0)])):w("",!0)]))),128))])])],512)]),m(b)])],64)}}});export{Ct as default};
