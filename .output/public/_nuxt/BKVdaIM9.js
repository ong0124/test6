const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./70Ph0dw5.js","./CPtqwm5Y.js","./QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{d as V,H as R,r as d,I as j,j as z,o as A,t as r,v as c,x as t,z as m,J as M,K as U,L as w,M as S,N as B,y as n,O as h,P as Q,Q as F}from"./CPtqwm5Y.js";import{_ as q,a as G}from"./BRT_4hIo.js";import J from"./-ILP5NnZ.js";import{_ as K}from"./Hk-Lu7kx.js";import{f as H}from"./D_RMiZWE.js";const W={class:"flex justify-evenly items-center"},Y={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},X={class:"flex flex-col ml-2 mb-16"},Z={class:"table-fixed min-w-full border-collapse border mr-12"},tt={class:"bg-gray-100"},et={key:0,class:"border p-2 text-xs md:text-sm bg-indigo-50"},st={class:"border p-2 text-xs md:text-md sticky left-0 bg-gray-50 z-10"},at={class:"border p-2 text-xs md:text-sm"},ot={class:"border p-2 text-xs md:text-sm"},lt={class:"border p-2 text-xs md:text-sm"},nt={class:"border p-2 text-xs md:text-sm"},rt={class:"border p-2 text-xs md:text-sm"},ct={class:"border p-2 text-xs md:text-sm"},dt={class:"border p-2 text-xs md:text-sm"},it={class:"border p-2 text-xs md:text-sm"},ut={class:"border p-2 text-xs md:text-sm"},mt={class:"border p-2 text-xs md:text-sm"},_t={class:"border p-2 text-xs md:text-sm"},pt={key:0},ft=["onClick"],St=V({__name:"index",setup(xt){const{t:_}=R(),y=d(""),$=j(),E=async()=>{const{jsPDF:s}=await F(async()=>{const{jsPDF:o}=await import("./70Ph0dw5.js");return{jsPDF:o}},__vite__mapDeps([0,1,2]),import.meta.url),l=(await F(async()=>{const{default:o}=await import("./CfO62xhj.js");return{default:o}},[],import.meta.url)).default,e=new s,b=await(await fetch("/fonts/SourceHanSans-Normal.ttf")).arrayBuffer(),a=btoa(new Uint8Array(b).reduce((o,O)=>o+String.fromCharCode(O),""));e.addFileToVFS("SourceHanSans-Normal.ttf",a),e.addFont("SourceHanSans-Normal.ttf","SourceHanSans-Normal","normal"),e.setFont("SourceHanSans-Normal"),e.text("訂單詳情",14,10);const u=[C],T=D.value.map(o=>[o.id,o.contact,o.phone,_(`${o.departure_loc}`),_(`${o.destination_loc}`),H(o.shuttle_date),o.shuttle_time,o.status,o.adult_num,o.child_num,o.totalTickets,o.totalprice]);l(e,{head:u,body:T,startY:20,styles:{fontSize:10,font:"SourceHanSans-Normal"},headStyles:{font:"SourceHanSans-Normal",fontStyle:"normal",fillColor:[22,160,133]},alternateRowStyles:{fillColor:[240,240,240]}}),e.save("訂單詳情.pdf")},D=z(()=>{const s=y.value.toLowerCase();return N.value.filter(l=>Object.values(l).some(e=>String(e).toLowerCase().includes(s)))}),C=["訂單 ID","聯絡人","電話號碼","上車地點","下車地點","日期","時間","狀態","成人票(人)","兒童票(人)","全票數","總價格"],P=s=>({"text-green-600 font-bold":s==="已完成","text-red-600 font-bold":s==="未出行","text-yellow-600 font-bold":s==="处理中"}),N=d([]),g=d([]),i=d("departure_loc"),p=async(s="departure_loc")=>{try{const l=await $fetch("/api/GETbooking",{query:{sortBy:s}});g.value=l.data,N.value=g.value.map(e=>({id:e.id,departure_loc:e.departure_loc,destination_loc:e.destination_loc,shuttle_date:e.shuttle_date,shuttle_time:e.shuttle_time,status:e.status,adult_num:e.adult_num,child_num:e.child_num,totalTickets:e.total_tickets,totalprice:e.totalprice,contact:e.contact_name,phone:e.contact_phone}))}catch(l){console.error("Fetch error:",l),alert("獲取數據失敗")}};A(()=>p(i.value));const f=d(null),x=d(!1),k=async s=>{console.log("選擇的動作:",s),s==="print"?E():s==="delete"?(x.value=!0,f.value&&f.value.scrollTo({left:f.value.scrollWidth,behavior:"smooth"})):s==="add"?$.push("/addOrders"):s==="timeAsc"?(i.value="shuttle_time",await p(i.value)):s==="locAsc"&&(i.value="departure_loc",await p(i.value))},L=async s=>{console.log("ID"+s);try{await $fetch("/api/DeleteBookingById",{method:"DELETE",body:{id:s}})?await p():alert("Post Failed: No valid response")}catch{alert("Delete error")}};return(s,l)=>{const e=q,v=J,I=K,b=G;return c(),r(S,null,[t("div",null,[m(e)]),t("div",null,[t("div",W,[t("div",Y,[m(v,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),M(t("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[U,y.value]])]),m(I,{onItemSelected:k,class:"z-20"})]),t("div",X,[t("div",{ref_key:"scrollContainer",ref:f,class:"overflow-x-auto w-full pb-4"},[t("table",Z,[t("thead",null,[t("tr",tt,[l[1]||(l[1]=t("th",{class:"border p-2 text-xs md:text-sm sticky left-0 bg-indigo-50"},"訂單ID",-1)),(c(!0),r(S,null,B(C.slice(1),(a,u)=>(c(),r("th",{key:u,class:"border p-2 text-xs md:text-sm bg-indigo-50"},n(a),1))),128)),x.value?(c(),r("th",et," 操作 ")):w("",!0)])]),t("tbody",null,[(c(!0),r(S,null,B(h(D),(a,u)=>(c(),r("tr",{key:u,class:"border-b text-center"},[t("td",st,n(a.id),1),t("td",at,n(a.contact),1),t("td",ot,n(a.phone),1),t("td",lt,n(h(_)(`${a.departure_loc}`)),1),t("td",nt,n(h(_)(`${a.destination_loc}`)),1),t("td",rt,n(("formatDate"in s?s.formatDate:h(H))(a.shuttle_date)),1),t("td",ct,n(a.shuttle_time),1),t("td",dt,[t("span",{class:Q(P(a.status))},n(a.status),3)]),t("td",it,n(a.adult_num),1),t("td",ut,n(a.child_num),1),t("td",mt,n(a.totalTickets),1),t("td",_t,n(a.totalprice),1),x.value?(c(),r("th",pt,[x.value?(c(),r("button",{key:0,class:"text-red-500 px-4 py-1 rounded",onClick:T=>L(a.id)},[m(v,{name:"mdi:delete",class:"text-red-500 w-5 h-5"})],8,ft)):w("",!0)])):w("",!0)]))),128))])])],512)]),m(b)])],64)}}});export{St as default};
