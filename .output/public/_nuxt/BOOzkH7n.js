import{d as N,_ as T,a as O}from"./4QqY3rdL.js";import z from"./BKpnw542.js";import{_ as A}from"./CIVeRsBe.js";import{d as F,X as H,S as J,t as m,L as I,x as t,y as p,J as V,K as U,z as i,A as R,O as E,v as f,r,o as G,j as K,M as C,N as Q,P as X,Y as S}from"./LZasg4HZ.js";import{p as q,n as W,D as Z}from"./D-G6fwHa.js";import{f as Y}from"./CHkz0D1a.js";import"./Dh0oQ4-4.js";import"./QjJsDpFa.js";const ee={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},te={class:"bg-white rounded-2xl p-6 w-[90%] max-w-md shadow-lg"},se={class:"text-xl font-bold mb-4 text-center"},oe={class:"mb-4"},le={key:0,class:"w-full border px-3 py-2 rounded bg-gray-100"},ae={class:"mb-4"},re={class:"mb-4 flex items-center"},ne={class:"flex justify-end space-x-2"},ie=F({__name:"UserPopup",props:{modelValue:{type:Boolean},isEdit:{type:Boolean}},emits:["update:modelValue","submit","submitted"],setup(P,{expose:g,emit:h}){const u=P,w=h,e=H({id:"",lineName:"",birthday:void 0}),v=o=>{console.log("Incoming data:",o),e.id=o.id??"",e.lineName=o.full_name??"",e.birthday=o.birthday?N(o.birthday):void 0};J(()=>u.modelValue,o=>{o&&!u.isEdit&&b()});const b=()=>{e.id="",e.lineName="",e.birthday=void 0},c=async()=>{try{u.isEdit?(await D(),console.log("id",e.id)):(await _(),console.log("id",e.id)),w("update:modelValue",!1),w("submitted")}catch(o){console.error("Error submitting form:",o)}},D=async()=>{try{await $fetch("/api/EditUser",{method:"PUT",body:{id:e.id,full_name:e.lineName,birthday:e.birthday?N(e.birthday).format("YYYY-MM-DD"):null}})}catch{alert("Edit blog error"),console.log("form",e)}},_=async()=>{try{const o=await $fetch("/api/POSTUser",{method:"POST",body:{id:e.id,full_name:e.lineName,birthday:e.birthday?N(e.birthday).format("YYYY-MM-DD"):null}});alert(o?"添加成功":"Post Failed: No valid response")}catch(o){console.error("PostData 失败:",o),alert("提交失败"),console.log("form",e)}};return g({setFormData:v}),(o,a)=>{const x=Z,k=q;return o.modelValue?(f(),m("div",ee,[t("div",te,[t("h2",se,p(o.isEdit?"編輯用戶":"新增用戶"),1),t("div",oe,[a[4]||(a[4]=t("div",{class:"mb-1 text-sm text-gray-700"},"用戶編號：",-1)),o.isEdit?(f(),m("div",le,p(e.id),1)):V((f(),m("input",{key:1,"onUpdate:modelValue":a[0]||(a[0]=d=>e.id=d),type:"number",class:"w-full border px-3 py-2 rounded"},null,512)),[[U,e.id]])]),t("div",ae,[a[5]||(a[5]=t("div",{class:"mb-1 text-sm text-gray-700"},"LINE名字：",-1)),V(t("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>e.lineName=d),type:"text",class:"w-full border px-3 py-2 rounded"},null,512),[[U,e.lineName]])]),t("div",re,[a[6]||(a[6]=t("div",{class:"mb-1 text-sm text-gray-700 pr-6"},"生日：",-1)),i(k,{locale:E(W)},{default:R(()=>[i(x,{value:e.birthday,"onUpdate:value":a[2]||(a[2]=d=>e.birthday=d)},null,8,["value"])]),_:1},8,["locale"])]),t("div",ne,[t("button",{onClick:a[3]||(a[3]=d=>o.$emit("update:modelValue",!1)),class:"px-4 py-2 bg-gray-300 rounded"},"取消"),t("button",{onClick:c,class:"px-4 py-2 bg-amber-500 text-white rounded"},p(o.isEdit?"更新":"提交"),1)])])])):I("",!0)}}}),de={class:"flex justify-evenly items-center"},ue={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},ce={class:"flex flex-col mb-20"},me={class:"grid grid-cols-[80px_1fr_1fr_1fr_60px] bg-gray-100 font-semibold text-sm text-gray-700 py-3 border-b border-gray-300 items-center"},pe={class:"flex justify-center"},fe={class:"bg-gray-100"},ve={key:0,class:"text-red-500 px-4 rounded ml-2r"},ke=F({__name:"checkUsers",setup(P){const g=r([]),h=r([]),u=async()=>{try{const l=await $fetch("/api/GetUser");h.value=l.data,g.value=h.value.map(s=>({id:s.id,full_name:s.full_name,birthday:s.birthday,created_at:s.created_at}))}catch{alert("Fetch error")}};G(u);const w=r([{label:"修改",action:"edit",icon:"ooui:recent-changes-ltr"},{label:"刪除",action:"delete",icon:"mdi:delete"},{label:"添加",action:"add",icon:"mdi:plus"}]),e=r(!1),v=r(!1),b=r(!1),c=r(""),D=r(null),_=r(),o=(l,s)=>{c.value=l,D.value=s??null,l==="edit"?(e.value=!0,S(()=>{var y;(y=_.value)==null||y.setFormData(s)})):l==="delete"?e.value=!0:l==="add"&&(b.value=!1,v.value=!0)},a=l=>{console.log("提交的資料:",l)},x=r(""),k=K(()=>{const l=x.value.toLowerCase();return g.value.filter(s=>Object.values(s).some(y=>String(y).toLowerCase().includes(l)))}),d=async l=>{if(c.value==="edit")b.value=!0,v.value=!0,D.value=l,console.log("Data:"+JSON.stringify(l)),S(()=>{var s;(s=_.value)==null||s.setFormData(l)});else if(c.value==="delete")try{await $fetch("/api/DeleteUser",{method:"DELETE",body:{id:l.id}})?await u():alert("Post Failed: No valid response")}catch{alert("Delete error")}};return(l,s)=>{const y=T,$=z,M=A,j=ie,L=O;return f(),m(C,null,[t("div",null,[i(y,{title:"查看用戶"})]),t("div",de,[t("div",ue,[i($,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),V(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>x.value=n),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[U,x.value]])]),i(M,{items:w.value,onItemSelected:o,class:"z-20"},null,8,["items"])]),t("div",ce,[t("div",me,[s[2]||(s[2]=t("div",{class:"text-center"},"用戶編號",-1)),s[3]||(s[3]=t("div",{class:"text-center"},"LINE 名字",-1)),s[4]||(s[4]=t("div",{class:"text-center"},"加入時間",-1)),s[5]||(s[5]=t("div",{class:"text-center"},"出生日期",-1)),t("div",pe,[i($,{name:"tdesign:setting-filled"})])]),(f(!0),m(C,null,Q(E(k),(n,B)=>(f(),m("div",{key:B,class:"grid grid-cols-[80px_1fr_1fr_1fr_60px] text-center text-sm py-3 border-b border-gray-300 items-center"},[t("div",null,p(n.id),1),t("div",null,p(n.full_name),1),t("div",fe,p(("formatDate"in l?l.formatDate:E(Y))(n.created_at)),1),t("div",null,p(("formatDate"in l?l.formatDate:E(Y))(n.birthday)),1),e.value?(f(),m("div",ve,[i($,{name:c.value==="edit"?"ooui:recent-changes-ltr":"streamline:file-delete-alternate-solid",class:X(c.value==="edit"?"text-blue-500 cursor-pointer":"text-red-500 cursor-pointer"),onClick:ye=>d(n)},null,8,["name","class","onClick"])])):I("",!0)]))),128))]),i(j,{ref_key:"popupRef",ref:_,modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=n=>v.value=n),isEdit:b.value,onSubmit:a,onSubmitted:u},null,8,["modelValue","isEdit"]),t("div",null,[i(L)])],64)}}});export{ke as default};
