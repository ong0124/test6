const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CknhwCGB.js","./BnletfD5.js","./QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{d as M,H as R,r as d,I as j,j as z,o as A,t as r,v as c,x as t,z as _,J as U,K as Q,L as w,M as S,N as F,y as l,O as p,P as q,Q as H}from"./BnletfD5.js";import{_ as G,a as J}from"./BSTs7FH2.js";import K from"./C6b958NV.js";import{_ as W}from"./DqYuFu8D.js";import{f as $}from"./BpB8Kkb9.js";function Y(D){return{complete:"完成",notTraveled:"未出行"}[D]||"未知状态"}const X={class:"flex justify-evenly items-center"},Z={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},tt={class:"flex flex-col ml-2 mb-16"},et={class:"table-fixed min-w-full border-collapse border mr-12"},st={class:"bg-gray-100"},at={key:0,class:"border p-2 text-xs md:text-sm bg-indigo-50"},ot={class:"border p-2 text-xs md:text-md sticky left-0 bg-gray-50 z-10"},lt={class:"border p-2 text-xs md:text-sm"},nt={class:"border p-2 text-xs md:text-sm"},rt={class:"border p-2 text-xs md:text-sm"},ct={class:"border p-2 text-xs md:text-sm"},dt={class:"border p-2 text-xs md:text-sm"},ut={class:"border p-2 text-xs md:text-sm"},it={class:"border p-2 text-xs md:text-sm"},mt={class:"border p-2 text-xs md:text-sm"},_t={class:"border p-2 text-xs md:text-sm"},pt={class:"border p-2 text-xs md:text-sm"},ft={class:"border p-2 text-xs md:text-sm"},xt={class:"border p-2 text-xs md:text-sm"},ht={key:0},yt=["onClick"],Ct=M({__name:"index",setup(D){const{t:u}=R(),y=d(""),E=j(),P=async()=>{const{jsPDF:e}=await H(async()=>{const{jsPDF:o}=await import("./CknhwCGB.js");return{jsPDF:o}},__vite__mapDeps([0,1,2]),import.meta.url),n=(await H(async()=>{const{default:o}=await import("./CfO62xhj.js");return{default:o}},[],import.meta.url)).default,s=new e,b=await(await fetch("/fonts/SourceHanSans-Normal.ttf")).arrayBuffer(),a=btoa(new Uint8Array(b).reduce((o,V)=>o+String.fromCharCode(V),""));s.addFileToVFS("SourceHanSans-Normal.ttf",a),s.addFont("SourceHanSans-Normal.ttf","SourceHanSans-Normal","normal"),s.setFont("SourceHanSans-Normal"),s.text("訂單詳情",14,10);const m=[T],B=C.value.map(o=>[o.id,o.contact,o.phone,u(`${o.departure_loc}`),u(`${o.destination_loc}`),$(o.shuttle_date),o.shuttle_time,o.status,o.adult_num,o.child_num,o.totalTickets,o.totalprice,o.payment_status]);n(s,{head:m,body:B,startY:20,styles:{fontSize:10,font:"SourceHanSans-Normal"},headStyles:{font:"SourceHanSans-Normal",fontStyle:"normal",fillColor:[22,160,133]},alternateRowStyles:{fillColor:[240,240,240]}}),s.save("訂單詳情.pdf")},C=z(()=>{const e=y.value.toLowerCase();return N.value.filter(n=>Object.values(n).some(s=>String(s).toLowerCase().includes(e)))}),T=["訂單 ID","聯絡人","電話號碼","上車地點","下車地點","日期","時間","狀態","成人票(人)","兒童票(人)","全票數","是否付款","總價格"],k=e=>({"text-green-600 font-bold":e==="已完成","text-red-600 font-bold":e==="未出行","text-yellow-600 font-bold":e==="处理中"}),N=d([]),g=d([]),i=d("departure_loc"),f=async(e="departure_loc")=>{try{const n=await $fetch("/api/GETbooking",{query:{sortBy:e}});g.value=n.data,N.value=g.value.map(s=>({id:s.id,departure_loc:s.departure_loc,destination_loc:s.destination_loc,shuttle_date:s.shuttle_date,shuttle_time:s.shuttle_time,status:s.status,adult_num:s.adult_num,child_num:s.child_num,totalTickets:s.total_tickets,totalprice:s.totalprice,contact:s.contact_name,phone:s.contact_phone,payment_status:s.payment_status}))}catch(n){console.error("Fetch error:",n),alert("獲取數據失敗")}};A(()=>f(i.value));const x=d(null),h=d(!1),L=async e=>{console.log("選擇的動作:",e),e==="print"?P():e==="delete"?(h.value=!0,x.value&&x.value.scrollTo({left:x.value.scrollWidth,behavior:"smooth"})):e==="add"?E.push("/addOrders"):e==="timeAsc"?(i.value="shuttle_time",await f(i.value)):e==="locAsc"&&(i.value="departure_loc",await f(i.value))},O=async e=>{console.log("ID"+e);try{await $fetch("/api/DeleteBookingById",{method:"DELETE",body:{id:e}})?await f():alert("Post Failed: No valid response")}catch{alert("Delete error")}};return(e,n)=>{const s=G,v=K,I=W,b=J;return c(),r(S,null,[t("div",null,[_(s)]),t("div",null,[t("div",X,[t("div",Z,[_(v,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),U(t("input",{"onUpdate:modelValue":n[0]||(n[0]=a=>y.value=a),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[Q,y.value]])]),_(I,{onItemSelected:L,class:"z-20"})]),t("div",tt,[t("div",{ref_key:"scrollContainer",ref:x,class:"overflow-x-auto w-full pb-4"},[t("table",et,[t("thead",null,[t("tr",st,[n[1]||(n[1]=t("th",{class:"border p-2 text-xs md:text-sm sticky left-0 bg-indigo-50"},"訂單ID",-1)),(c(!0),r(S,null,F(T.slice(1),(a,m)=>(c(),r("th",{key:m,class:"border p-2 text-xs md:text-sm bg-indigo-50"},l(a),1))),128)),h.value?(c(),r("th",at," 操作 ")):w("",!0)])]),t("tbody",null,[(c(!0),r(S,null,F(p(C),(a,m)=>(c(),r("tr",{key:m,class:"border-b text-center"},[t("td",ot,l(a.id),1),t("td",lt,l(a.contact),1),t("td",nt,l(a.phone),1),t("td",rt,l(p(u)(`${a.departure_loc}`)),1),t("td",ct,l(p(u)(`${a.destination_loc}`)),1),t("td",dt,l(("formatDate"in e?e.formatDate:p($))(a.shuttle_date)),1),t("td",ut,l(a.shuttle_time),1),t("td",it,[t("span",{class:q(k(a.status))},l(("TranslateStatus"in e?e.TranslateStatus:p(Y))(a.status)),3)]),t("td",mt,l(a.adult_num),1),t("td",_t,l(a.child_num),1),t("td",pt,l(a.totalTickets),1),t("td",ft,l(a.payment_status),1),t("td",xt,l(a.totalprice),1),h.value?(c(),r("th",ht,[h.value?(c(),r("button",{key:0,class:"text-red-500 px-4 py-1 rounded",onClick:B=>O(a.id)},[_(v,{name:"mdi:delete",class:"text-red-500 w-5 h-5"})],8,yt)):w("",!0)])):w("",!0)]))),128))])])],512)]),_(b)])],64)}}});export{Ct as default};
