const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D1nBt6YF.js","./LZasg4HZ.js","./QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{d as z,H as M,r as d,I as U,j as I,o as A,t as r,v as c,x as t,z as u,J as Q,K as G,L as v,M as b,N as T,y as n,O as f,P as J,Q as F}from"./LZasg4HZ.js";import{_ as K,a as W}from"./4QqY3rdL.js";import Y from"./BKpnw542.js";import{_ as q}from"./CIVeRsBe.js";import{f as H}from"./CHkz0D1a.js";const X={class:"flex justify-evenly items-center"},Z={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},tt={class:"flex flex-col ml-2 mb-16"},et={class:"table-fixed min-w-full border-collapse border mr-12"},st={class:"bg-gray-100"},at={key:0,class:"border p-2 text-xs md:text-sm bg-indigo-50"},ot={class:"border p-2 text-xs md:text-md sticky left-0 bg-gray-50 z-10"},nt={class:"border p-2 text-xs md:text-sm"},lt={class:"border p-2 text-xs md:text-sm"},rt={class:"border p-2 text-xs md:text-sm"},ct={class:"border p-2 text-xs md:text-sm"},dt={class:"border p-2 text-xs md:text-sm"},it={class:"border p-2 text-xs md:text-sm"},ut={class:"border p-2 text-xs md:text-sm"},mt={class:"border p-2 text-xs md:text-sm"},_t={class:"border p-2 text-xs md:text-sm"},pt={class:"border p-2 text-xs md:text-sm"},ft={class:"border p-2 text-xs md:text-sm"},xt={key:0},ht=["onClick"],$=10,Ct=z({__name:"index",setup(yt){const{t:m}=M(),x=d(""),E=U(),O=async()=>{const{jsPDF:e}=await F(async()=>{const{jsPDF:o}=await import("./D1nBt6YF.js");return{jsPDF:o}},__vite__mapDeps([0,1,2]),import.meta.url),s=(await F(async()=>{const{default:o}=await import("./CfO62xhj.js");return{default:o}},[],import.meta.url)).default,l=new e,y=await(await fetch("/fonts/SourceHanSans-Normal.ttf")).arrayBuffer(),a=btoa(new Uint8Array(y).reduce((o,j)=>o+String.fromCharCode(j),""));l.addFileToVFS("SourceHanSans-Normal.ttf",a),l.addFont("SourceHanSans-Normal.ttf","SourceHanSans-Normal","normal"),l.setFont("SourceHanSans-Normal"),l.text("訂單詳情",14,10);const i=[w],P=S.value.map(o=>[o.id,o.contact,o.phone,m(`${o.departure_loc}`),m(`${o.destination_loc}`),H(o.shuttle_date),o.shuttle_time,o.status,o.adult_num,o.child_num,o.totalTickets,o.totalprice]);s(l,{head:i,body:P,startY:20,styles:{fontSize:10,font:"SourceHanSans-Normal"},headStyles:{font:"SourceHanSans-Normal",fontStyle:"normal",fillColor:[22,160,133]},alternateRowStyles:{fillColor:[240,240,240]}}),l.save("訂單詳情.pdf")},B=I(()=>{const e=x.value.toLowerCase();return D.value.filter(s=>Object.values(s).some(l=>String(l).toLowerCase().includes(e)))}),w=["訂單 ID","聯絡人","電話號碼","上車地點","下車地點","日期","時間","狀態","成人票(人)","兒童票(人)","全票數","總價格"],k=d(1),S=I(()=>{const e=(k.value-1)*$;return B.value.slice(e,e+$)}),L=e=>({"text-green-600 font-bold":e==="已完成","text-red-600 font-bold":e==="未出行","text-yellow-600 font-bold":e==="处理中"}),D=d([]),C=d([]),g=async()=>{try{const e=await $fetch("/api/GETallOrders");C.value=e.data,D.value=C.value.map(s=>({id:s.id,departure_loc:s.departure_loc,destination_loc:s.destination_loc,shuttle_date:s.shuttle_date,shuttle_time:s.shuttle_time,status:s.status,adult_num:s.adult_num,child_num:s.child_num,totalTickets:s.total_tickets,totalprice:s.totalprice,contact:s.contact_name,phone:s.contact_phone}))}catch{alert("Fetch error")}};A(g);const _=d(null),p=d(!1),V=e=>{e==="print"?O():e==="delete"?(p.value=!0,_.value&&_.value.scrollTo({left:_.value.scrollWidth,behavior:"smooth"})):e==="add"&&E.push("/addOrders")},R=async e=>{console.log("ID"+e);try{await $fetch("/api/DeleteBookingById",{method:"DELETE",body:{id:e}})?await g():alert("Post Failed: No valid response")}catch{alert("Delete error")}};return(e,s)=>{const l=K,h=Y,N=q,y=W;return c(),r(b,null,[t("div",null,[u(l)]),t("div",null,[t("div",X,[t("div",Z,[u(h,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),Q(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>x.value=a),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[G,x.value]])]),u(N,{onItemSelected:V,class:"z-20"})]),t("div",tt,[t("div",{ref_key:"scrollContainer",ref:_,class:"overflow-x-auto w-full pb-4"},[t("table",et,[t("thead",null,[t("tr",st,[s[1]||(s[1]=t("th",{class:"border p-2 text-xs md:text-sm sticky left-0 bg-indigo-50"},"訂單ID",-1)),(c(!0),r(b,null,T(w.slice(1),(a,i)=>(c(),r("th",{key:i,class:"border p-2 text-xs md:text-sm bg-indigo-50"},n(a),1))),128)),p.value?(c(),r("th",at," 操作 ")):v("",!0)])]),t("tbody",null,[(c(!0),r(b,null,T(f(S),(a,i)=>(c(),r("tr",{key:i,class:"border-b text-center"},[t("td",ot,n(a.id),1),t("td",nt,n(a.contact),1),t("td",lt,n(a.phone),1),t("td",rt,n(f(m)(`${a.departure_loc}`)),1),t("td",ct,n(f(m)(`${a.destination_loc}`)),1),t("td",dt,n(("formatDate"in e?e.formatDate:f(H))(a.shuttle_date)),1),t("td",it,n(a.shuttle_time),1),t("td",ut,[t("span",{class:J(L(a.status))},n(a.status),3)]),t("td",mt,n(a.adult_num),1),t("td",_t,n(a.child_num),1),t("td",pt,n(a.totalTickets),1),t("td",ft,n(a.totalprice),1),p.value?(c(),r("th",xt,[p.value?(c(),r("button",{key:0,class:"text-red-500 px-4 py-1 rounded",onClick:P=>R(a.id)},[u(h,{name:"mdi:delete",class:"text-red-500 w-5 h-5"})],8,ht)):v("",!0)])):v("",!0)]))),128))])])],512)]),u(y)])],64)}}});export{Ct as default};
