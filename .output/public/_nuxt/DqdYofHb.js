import{d as N,_ as T,a as O}from"./OXcFyBNm.js";import z from"./BxoEwoNZ.js";import{_ as A}from"./aGsdCfVp.js";import{d as I,K as H,J,t as p,O as M,x as t,y as f,L as V,M as U,z as i,A as Q,N as E,v,r,o as R,j as G,P,Q as K,S as Z,Z as S}from"./BdNMLq4u.js";import{C as q,l as W,D as X}from"./CgUx8BTR.js";import{f as F}from"./BVNrtfBT.js";const ee={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},te={class:"bg-white rounded-2xl p-6 w-[90%] max-w-md shadow-lg"},oe={class:"text-xl font-bold mb-4 text-center"},se={class:"mb-4"},le={key:0,class:"w-full border px-3 py-2 rounded bg-gray-100"},ae={class:"mb-4"},re={class:"mb-4 flex items-center"},ne={class:"flex justify-end space-x-2"},ie=I({__name:"UserPopup",props:{modelValue:{type:Boolean},isEdit:{type:Boolean}},emits:["update:modelValue","submit","submitted"],setup(C,{expose:g,emit:h}){const u=C,w=h,e=H({id:"",lineName:"",birthday:void 0}),y=s=>{console.log("Incoming data:",s),e.id=s.id??"",e.lineName=s.full_name??"",e.birthday=s.birthday?N(s.birthday):void 0};J(()=>u.modelValue,s=>{s&&!u.isEdit&&b()});const b=()=>{e.id="",e.lineName="",e.birthday=void 0},c=async()=>{try{u.isEdit?(await D(),console.log("id",e.id)):(await _(),console.log("id",e.id)),w("update:modelValue",!1),w("submitted")}catch(s){console.error("Error submitting form:",s)}},D=async()=>{try{await $fetch("/api/EditUser",{method:"PUT",body:{id:e.id,full_name:e.lineName,birthday:e.birthday?N(e.birthday).format("YYYY-MM-DD"):null}})}catch{alert("Edit blog error"),console.log("form",e)}},_=async()=>{try{const s=await $fetch("/api/POSTUser",{method:"POST",body:{id:e.id,full_name:e.lineName,birthday:e.birthday?N(e.birthday).format("YYYY-MM-DD"):null}});alert(s?"添加成功":"Post Failed: No valid response")}catch(s){console.error("PostData 失败:",s),alert("提交失败"),console.log("form",e)}};return g({setFormData:y}),(s,a)=>{const x=X,k=q;return s.modelValue?(v(),p("div",ee,[t("div",te,[t("h2",oe,f(s.isEdit?"編輯用戶":"新增用戶"),1),t("div",se,[a[4]||(a[4]=t("div",{class:"mb-1 text-sm text-gray-700"},"用戶編號：",-1)),s.isEdit?(v(),p("div",le,f(e.id),1)):V((v(),p("input",{key:1,"onUpdate:modelValue":a[0]||(a[0]=d=>e.id=d),type:"number",class:"w-full border px-3 py-2 rounded"},null,512)),[[U,e.id]])]),t("div",ae,[a[5]||(a[5]=t("div",{class:"mb-1 text-sm text-gray-700"},"LINE名字：",-1)),V(t("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>e.lineName=d),type:"text",class:"w-full border px-3 py-2 rounded"},null,512),[[U,e.lineName]])]),t("div",re,[a[6]||(a[6]=t("div",{class:"mb-1 text-sm text-gray-700 pr-6"},"生日：",-1)),i(k,{locale:E(W)},{default:Q(()=>[i(x,{value:e.birthday,"onUpdate:value":a[2]||(a[2]=d=>e.birthday=d)},null,8,["value"])]),_:1},8,["locale"])]),t("div",ne,[t("button",{onClick:a[3]||(a[3]=d=>s.$emit("update:modelValue",!1)),class:"px-4 py-2 bg-gray-300 rounded"},"取消"),t("button",{onClick:c,class:"px-4 py-2 bg-amber-500 text-white rounded"},f(s.isEdit?"更新":"提交"),1)])])])):M("",!0)}}}),de={class:"flex justify-evenly items-center"},ue={class:"flex items-center border-2 border-blue-500 rounded-md w-2/3 my-2 ml-4"},ce={class:"flex flex-col mb-20"},me={class:"grid grid-cols-[80px_1fr_1fr_1fr_60px] bg-gray-100 font-semibold text-sm text-gray-700 py-3 border-b border-gray-300 items-center"},pe={class:"flex justify-center"},fe={class:"bg-gray-100"},ve={key:0,class:"text-red-500 px-4 rounded ml-2r"},De=I({__name:"checkUsers",setup(C){const g=r([]),h=r([]),u=async()=>{try{const l=await $fetch("/api/GetUser");h.value=l.data,g.value=h.value.map(o=>({id:o.id,full_name:o.full_name,birthday:o.birthday,created_at:o.created_at}))}catch{alert("Fetch error")}};R(u);const w=r([{label:"修改",action:"edit",icon:"ooui:recent-changes-ltr"},{label:"刪除",action:"delete",icon:"mdi:delete"},{label:"添加",action:"add",icon:"mdi:plus"}]),e=r(!1),y=r(!1),b=r(!1),c=r(""),D=r(null),_=r(),s=(l,o)=>{c.value=l,D.value=o??null,l==="edit"?(e.value=!0,S(()=>{var m;(m=_.value)==null||m.setFormData(o)})):l==="delete"?e.value=!0:l==="add"&&(b.value=!1,y.value=!0)},a=l=>{console.log("提交的資料:",l)},x=r(""),k=G(()=>{const l=x.value.toLowerCase();return g.value.filter(o=>Object.values(o).some(m=>String(m).toLowerCase().includes(l)))}),d=async l=>{if(c.value==="edit")b.value=!0,y.value=!0,D.value=l,console.log("Data:"+JSON.stringify(l)),S(()=>{var o;(o=_.value)==null||o.setFormData(l)});else if(c.value==="delete"){if(!confirm("你確定要刪除此用戶嗎？"))return;try{await $fetch("/api/DeleteUser",{method:"DELETE",body:{id:l.id}})?await u():alert("Post Failed: No valid response")}catch{alert("Delete error")}}};return(l,o)=>{const m=T,$=z,Y=A,j=ie,L=O;return v(),p(P,null,[t("div",null,[i(m,{title:"查看用戶"})]),t("div",de,[t("div",ue,[i($,{name:"material-symbols-search-rounded",class:"h-5 w-5 text-gray-500 mx-2"}),V(t("input",{"onUpdate:modelValue":o[0]||(o[0]=n=>x.value=n),type:"text",class:"py-1 w-full rounded-md focus:ring-0 focus:border-transparent border-none outline-none",placeholder:"搜索訂單"},null,512),[[U,x.value]])]),i(Y,{items:w.value,onItemSelected:s,class:"z-20"},null,8,["items"])]),t("div",ce,[t("div",me,[o[2]||(o[2]=t("div",{class:"text-center"},"用戶編號",-1)),o[3]||(o[3]=t("div",{class:"text-center"},"LINE 名字",-1)),o[4]||(o[4]=t("div",{class:"text-center"},"加入時間",-1)),o[5]||(o[5]=t("div",{class:"text-center"},"出生日期",-1)),t("div",pe,[i($,{name:"tdesign:setting-filled"})])]),(v(!0),p(P,null,K(E(k),(n,B)=>(v(),p("div",{key:B,class:"grid grid-cols-[80px_1fr_1fr_1fr_60px] text-center text-sm py-3 border-b border-gray-300 items-center"},[t("div",null,f(n.id),1),t("div",null,f(n.full_name),1),t("div",fe,f(("formatDate"in l?l.formatDate:E(F))(n.created_at)),1),t("div",null,f(("formatDate"in l?l.formatDate:E(F))(n.birthday)),1),e.value?(v(),p("div",ve,[i($,{name:c.value==="edit"?"ooui:recent-changes-ltr":"streamline:file-delete-alternate-solid",class:Z(c.value==="edit"?"text-blue-500 cursor-pointer":"text-red-500 cursor-pointer"),onClick:ye=>d(n)},null,8,["name","class","onClick"])])):M("",!0)]))),128))]),i(j,{ref_key:"popupRef",ref:_,modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=n=>y.value=n),isEdit:b.value,onSubmit:a,onSubmitted:u},null,8,["modelValue","isEdit"]),t("div",null,[i(L)])],64)}}});export{De as default};
